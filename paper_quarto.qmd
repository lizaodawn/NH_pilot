---
engine: knitr
title: "Keyword and Collocation analysis on India-related text of Natural History"
author: "Lizao Zhuang (Dawn) r0914937"
format: 
  html:
    theme: journal
    toc: true
    code-link: true
    abstract-title: "Abstract"
number-sections: true
code-fold: true
bibliography:
  - references.bib
  - packages.bib  
csl: unified-style-sheet-for-linguistics.csl
abstract: 'The paper applies the methodology of keyword analysis and collocation analysis in corpus linguistics to explore the possible topics of the text related to "India" in Natural History of Pliny the Elder.'
---

```{r setup, include=FALSE}
library('tidyverse')
library('mclm')
library('here')
library('kableExtra')
library('dplyr')
library('ggplot2')
library('leaflet')
options(digits = 3)

knitr::write_bib(
  c("base", "mclm", "ggplot2", "tidyverse", "leaflet"),
  here("packages.bib")
)
```

# Research Question

Pliny the Elder's "Natural History" stands as a seminal work in the history of encyclopedias, serving as a gateway to understanding the knowledge and worldview of ancient Rome. Beyond its role as a compendium of diverse subjects, the text provides a captivating glimpse into the actual merchant exchanges [@dodd2021] of the Roman Empire while shedding a light on the spatial imagination of Pliny and the scholarly references of his time [@plinyth2011].

The text of the whole book has been digitized and annotated with people's name, places' name and coordinates by [TOPOSText](https://topostext.org/the-project) project since 2012. This invaluable resource allows for the creation of a dataset that includes both the textual contents and geographical annotations, which can be utilized to investigate the distribution of place names in the entire text and examine the frequencies and patterns of geographically-related content.

As a starting point, @fig-geoname reveals the Top 20 distinct geographical names mentioned within the text.

```{r}
#| label: fig-geoname
#| fig-cap: Bar Chart for Top 20 Distinct Place Names Mentioned in Natural History
#| fig-cap-location: top
#| warning: false
#| echo: false


data <- read.csv("geotext_whole.csv")

summary_data <- data %>%
  group_by(ToposText_ID, Place_Name, Lat, Long) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count)) %>%
  ungroup()

top_20_summary_data <- summary_data %>%
  top_n(20, Count) %>%
  ungroup()

ggplot(top_20_summary_data, aes(x = reorder(Place_Name, -Count), y = Count)) +
  geom_bar(stat = "identity") +
  labs(x = "Place Name", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

An intriguing observation from this analysis, as depicted in @fig-map, is the prominence of India---a region outside the Mediterranean---despite its high frequency of mentions.

```{r}
#| label: fig-map
#| fig-cap: Mapping of geographical names mentioned in Natural History
#| fig-cap-location: top
#| warning: false
#| echo: false

m <- leaflet() %>%
  addTiles() %>%
  addCircleMarkers(
    data = top_20_summary_data,
    lat = ~Lat,
    lng = ~Long,
    radius = sqrt(top_20_summary_data$Count) * 0.8,  
    color = "blue",
    fill = TRUE,
    fillOpacity = 0.6,
    popup = paste("Place Name:", top_20_summary_data$Place_Name, "<br>",
                  "Count:", top_20_summary_data$Count)
  ) 

m

```

Building upon this observation, this paper aims to delve deeper into the themes associated with the India region by employing keyword analysis and collocation analysis methods within the framework of corpus linguistics.

The analysis is conducted in R environment [@R-base], and the main corpus linguistics anlysing methods are applied through functions from [mclm](https://masterclm.github.io/mclm/) [@R-mclm] package. In addition, [tidyverse](https://www.tidyverse.org/) [@R-tidyverse] and [leaflet](https://rstudio.github.io/leaflet/) [@R-leaflet] are used for data manipulation and visualisation.

# Corpus Description

As mentioned earlier, the digitized text of "Natural History" with geographical annotations is readily accessible through the [TOPOSText](https://topostext.org/work/148 "Check Natural History on ToposText") project. In order to facilitate the analysis, I conducted additional scraping of the full text, exporting it as a **reference corpus** in .txt format. Furthermore, I extracted the texts specifically associated with the Indian subcontinent, utilizing the annotated coordinates, creating a **target corpus** of geographically related texts focused on India. The scraping was conducted with [beautifulsoup](https://www.crummy.com/software/BeautifulSoup/bs4/doc/) library in python, the [code](https://github.com/lizaodawn/zhuang/blob/papertry/Natural%20History_corpus%20scrape.ipynb) can be referred by click.[^1]

[^1]: Since the paper is a pilot exploration of my master thesis, I used the scraped corpus already scraped with python.

```{r}
#| label: prepare-corpus
#| warning: false

refcorpus_folder <- here("NH_wholetext")
fnames_wholetext <- get_fnames(refcorpus_folder) %>% 
  keep_re("[.]txt")


tarcorpus_folder <-  here("NH_geotext_india")
fnames_indiatext <- get_fnames(tarcorpus_folder) %>% 
  keep_re("[.]txt")

ref_flist <- freqlist(fnames_wholetext, re_token_splitter = re("\\s+"))
tar_flist <- freqlist(fnames_indiatext, re_token_splitter = re("\\s+"))
```

The **reference corpus** consists of all texts in the encyclopedia, divided by paragraphs, has `r prettyNum(n_tokens(ref_flist))` tokens and `r n_types(ref_flist)` types, with the type-token ratio of `r round(n_types(ref_flist)/n_tokens(ref_flist), 2)`.

And the **target corpus** consists of all text related to Indian subcontinent (with coordinates in range of *8째4'N-37째6'N and 68째7'E to 97째25'E*) , has `r prettyNum(n_tokens(tar_flist))` tokens and `r n_types(tar_flist)` types, with the type-token ratio of `r round(n_types(tar_flist)/n_tokens(tar_flist), 2)`.

The punctuation marks are removed in the tokenization process.

# Keyword Analysis on India-related texts

The frequency list of the **target corpus** (Indian subcontinent related texts) and **reference corpus** (whole text) are generated respectively. And the association scores are calculated and filtered for those returning both PMI and $G^2$ gaining 2 or higher (in which criteria indicating the words having an at least four times higher probability than that in all the data taken together, as well as having a confirming evidence statistically [@methods]), in order to get the statistically most significant keyword in India-related texts comparing to the reference corpus.

When calculating the word frequency in the **target corpus**, the word "india" itself is removed from the token in order to get more descriptive words in the corpus, which will be more efficient in implying the possible thematic keyword in the **target corpus**.

```{r}
#| label: keyword
#| warning: false


# build frequency list for target corpus
flist_target <- fnames_indiatext %>%
  freqlist(
    re_token_transf_in = "[[:punct:]]", # Match punctuation marks
    token_transf_out = "", # Replace punctuation marks with an empty string
    re_drop_token = "india"
  )

# build frequency list for reference corpus
flist_ref <- fnames_wholetext %>%
  freqlist(
    re_token_transf_in = "[[:punct:]]", # Match punctuation marks
    token_transf_out = ""
  ) 

# calculate scores
scores_kw <- assoc_scores(flist_target, flist_ref)

top_scores_kw <- scores_kw %>% 
  filter(PMI >= 2 & G_signed >= 2)

```

Tables below shows the top 20 keywords in Indian related texts comparing to the entire texts in the encyclopedia, respectively sorted by PMI (@tbl-kwtable_PMI) and G_signed (@tbl-kwtable_Gsigned).

::: panel-tabset
## Sorted by PMI

```{r}
#| warning: false
#| echo: false
#| label: tbl-kwtable_PMI
#| tbl-cap-location: top
#| tbl-cap: Top 20 Keywords on Indian Related Text in Natural History (sorted by PMI)

top_scores_kw %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% 
  slice_max(order_by = PMI, n = 20, with_ties = TRUE) %>%                       
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)")) %>% 
  kable_minimal() %>% 
  scroll_box(height = "400px")
```

## Sorted by G_signed

```{r}
#| warning: false
#| echo: false
#| label: tbl-kwtable_Gsigned
#| tbl-cap-location: top
#| tbl-cap: Top 20 Keywords on Indian Related Text in Natural History (sorted by G_Signed)

top_scores_kw %>% # also valid for top_scores_colloc
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>%         # sort by PMI (descending) 
  slice_max(order_by = G_signed, n = 20, with_ties = TRUE) %>%   # select top 30 rows
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)")) %>% 
  kable_minimal() %>% 
  scroll_box(height = "400px")
```
:::

As **PMI Score** is seen as the indicator for keyword analysis, the top 20 keywords sorted by PMI were further checked of the meaning and tagged of its type manually. @tbl-kwlist below shows the explanation of the top 20 keywords in Indian related text.

```{r}
#| warning: false
#| echo: false
#| label: tbl-kwlist
#| tbl-cap: Top 20 keywords with meaning sorted by PMI
#| tbl-cap-location: top

keyword_PMI_list <- data.frame(
  Word = c("ganges", "beryls", "ichthyophagi", "megasthenes", "obsidian", "bdellium", "agates", "callaina", "condensation", "gerra", "jomanes", "nonius", "prasii", "alia", "carnelian", "cophes", "hypasis", "merchandize", "peppertree", "sacae", "sandastros", "thornbush"),
  Exp = c("a major river in India", "a type of gemstone", "a group of people who primarily subsist on fish", "a Greek historian and diplomat", "a type of volcanic glass", "a fragrant resin obtained from certain trees", "a type of semiprecious gemstone", "pale green precious stone (lat)", "the process of vapor turning into a liquid state", "war (lat)", "a Roman nomen gentile, gens or \"family name\"", "a Roman nomen gentile, gens or \"family name\"", "prase, green coloured gem", "by another / different way / route (lat)", "a reddish-brown variety of chalcedony", "a river that rises in the ancient Paropamise range, eventually falling into the Indus river near its confluence with the Cophes river", "a river in north India", "goods or commodities", "a tree that produces peppercorns", "the easternmost nation of Elibe, situated to the south of Ilia and the north of Bern", "a precious stone found in India and Arabia", "any of many thorny or spiny shrubs and bushes"),
  Tag = c("river", "goods", "people", "people", "goods", "goods", "goods", "goods", "activity", "activity", "people", "people", "goods", "route", "goods", "river", "river", "goods", "tree", "river", "goods", "tree"),
  Sub_tag = c("N/A", "stone", "group of people", "famous people", "others", "others", "stone", "stone", "producing activity", "N/A", "human name", "human name", "stone", "N/A", "stone", "N/A", "N/A", "general", "origin of goods", "N/A", "stone", "N/A")
) 

keyword_PMI_list %>% 
  as_tibble() %>%
  select(Word, Exp, Tag, Sub_tag) %>%                        
  kbl(col.names = c("Word", "Exp", "Tag", "Sub_tag")) %>% 
  kable_minimal()
```

As the distribution plot of categories @fig-kwtype manifested, most keywords about Indian related texts in Natural History have a potential topic of goods (especially precious stones), and also people (both tribes and famous diplomats) and rivers in India (carrying the important role of origin of goods or transportation routes), which incorporates the investigation in [@nappo2017].

```{r}
#| warning: false
#| echo: false
#| label: fig-kwtype
#| fig-cap: Top 20 keywords type distribution
#| fig-cap-location: top

tag_counts <- keyword_PMI_list %>%
  count(Tag) %>%
  arrange(desc(n))

# Plot the tag distribution
ggplot(tag_counts, aes(x = n, y = reorder(Tag, -n), fill = Tag)) +
  geom_bar(stat = "identity") +
  labs(x = "Count", y = "Tag", fill = "Tag") +
  theme_minimal() +
  coord_flip()
```

# Collocation Analysis on "India" in the whole corpus

In addition to the investigation on the keywords in the "Indian" related texts, it is also worthwhile having a look at what words collocated when Pliny the Elder referred to the word "India".

By indicating "india" as the target item for the analysis through the function of [surf_cooc](https://masterclm.github.io/mclm/reference/create_cooc.html) in [@R-mclm] and removing the punctuation marks, similarly to the Keyword Analysis criteria chosen above, collocation scores for co-text of both right and left side of "india" are calculated and filtered with those with both PMI and G_signed scores as 2 or above to get the prominent collocates of "india", in order to get an concrete overview of the discourse and recognization of Pliny the Elder to "India".

```{r}
#| label: collocation
#| warning: false

coocs <- fnames_wholetext %>% 
  surf_cooc("(?xi)  ^ india $", 
            re_token_transf_in = "[[:punct:]]", # Match punctuation marks
            token_transf_out = "")

# calculate scores
scores_colloc <- assoc_scores(coocs)

top_scores_colloc <- scores_colloc %>% 
  filter(PMI >= 2 & G_signed >= 2)
```

@tbl-coltable_Gsigned and @tbl-coltable_PMI shows the top 20 collocates to the word "india" in the whole text, respectively sorted by PMI and G_signed.

::: panel-tabset
## Sorted by G_singed

```{r}
#| label: tbl-coltable_Gsigned
#| tbl-cap-location: top
#| tbl-cap: Top 20 collocates to the word "india" in Natural History (sorted by PMI)
#| warning: false
#| echo: false
top_scores_colloc %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% 
  slice_max(order_by = G_signed, n = 20, with_ties = TRUE) %>%
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)"), escape = FALSE) %>%
  kable_minimal() %>% 
  scroll_box(height = "400px")

```

## Sorted by PMI

```{r}
#| label: tbl-coltable_PMI
#| tbl-cap-location: top
#| tbl-cap: Top 20 collocates to the word "india" in Natural History (sorted by PMI)
#| warning: false
#| echo: false

top_scores_colloc %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>%
  slice_max(order_by = PMI, n = 20, with_ties = TRUE) %>% 
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)"), escape = FALSE) %>% 
  kable_minimal() %>% 
  scroll_box(height = "400px") 

```
:::

As the returned $G^2$ indicates the strongness of evidence of the independency of the two words,

In addition, as shown in @tbl-concordance, with the concordance table of word "india" providing more details about the context of "India".

```{r}
#| label: tbl-concordance
#| tbl-cap-location: top
#| tbl-cap: Concordance table of word "india" in Natural History
#| warning: false
#| echo: false

conc_data <- conc(fnames_wholetext, '\\bindia\\b')

conc_data %>%
  as_tibble() %>%
  select(source, left, match, right) %>%
  mutate(
    source = short_names(source),
    book = as.integer(gsub("^(\\d+).*", "\\1", source)),
    chapter = as.numeric(gsub("^\\d+\\.(\\d+)\\.\\d+_text$", "\\1", source)),
    paragraph = as.numeric(gsub("^\\d+\\.\\d+\\.(\\d+)_text$", "\\1", source))
  ) %>%
  arrange(book, chapter, paragraph) %>%
  select(book, chapter, paragraph, left, match, right) %>%
  kbl(align = c("r", "r", "r", "c", "l", "l", "l")) %>%
  kable_paper(font_size = 15) %>%
  scroll_box(height = "400px")
```

# Conclusion

Trade related words (including important transportation milestones, trading goods and the description of the goods (colors, precious, etc.)) are more prone to be occur in the text related to India. It reflects the trading connection of the two empires, and also how the recognition of the other empire for the scholars of that period.
