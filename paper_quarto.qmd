---
engine: knitr
title: "Keyword and Collocation analysis on India-related text of Natural History"
author: "Lizao Zhuang (Dawn) r0914937"
format: 
  html:
    theme: journal
    toc: true
    code-link: true
    abstract-title: "Abstract"
number-sections: true
code-fold: true
bibliography:
  - references.bib
  - packages.bib  
csl: unified-style-sheet-for-linguistics.csl
abstract: 'The paper applies the methodology of keyword analysis and collocation analysis in corpus linguistics to explore the possible topics of the text related to "India" in Natural History of Pliny the Elder.'
---

```{r setup, include=FALSE}
library('tidyverse')
library('mclm')
library('here')
library('kableExtra')
library('dplyr')
library('ggplot2')
library('leaflet')
options(digits = 3)

knitr::write_bib(
  c("base", "mclm", "ggplot2", "tidyverse", "leaflet"),
  here("packages.bib")
)
```

# Research Question

Pliny the Elder's "Natural History" stands as a seminal work in the history of encyclopedias, serving as a gateway to understanding the knowledge and worldview of ancient Rome. Beyond its role as a compendium of diverse subjects, the text provides a captivating glimpse into the actual merchant exchanges [@dodd2021] of the Roman Empire while shedding a light on the spatial imagination of Pliny and the scholarly references of his time [@nappo2017].

The text of the whole book has been digitized and annotated with people's name, places' name and coordinates by [TOPOSText](https://topostext.org/the-project) project since 2012. This invaluable resource allows for the creation of a dataset that includes both the textual contents and geographical annotations, which can be utilized to investigate the distribution of place names in the entire text and examine the frequencies and patterns of geographically-related content.

As a starting point, @fig-geoname reveals the Top 20 distinct geographical names mentioned within the text.

```{r}
#| label: fig-geoname
#| fig-cap: Bar Chart for Top 20 Distinct Place Names Mentioned in Natural History
#| fig-cap-location: top
#| warning: false
#| echo: false


data <- read.csv("geotext_whole.csv")

summary_data <- data %>%
  group_by(ToposText_ID, Place_Name, Lat, Long) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count)) %>%
  ungroup()

top_20_summary_data <- summary_data %>%
  top_n(20, Count) %>%
  ungroup()

ggplot(top_20_summary_data, aes(x = reorder(Place_Name, -Count), y = Count)) +
  geom_bar(stat = "identity") +
  labs(x = "Place Name", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

An intriguing observation from this analysis, as depicted in @fig-map, is the prominence of India---a region outside the Mediterranean---despite its high frequency of mentions.

```{r}
#| label: fig-map
#| fig-cap: Mapping of geographical names mentioned in Natural History
#| fig-cap-location: top
#| warning: false
#| echo: false

m <- leaflet() %>%
  addTiles() %>%
  addCircleMarkers(
    data = top_20_summary_data,
    lat = ~Lat,
    lng = ~Long,
    radius = sqrt(top_20_summary_data$Count) * 0.8,  
    color = "blue",
    fill = TRUE,
    fillOpacity = 0.6,
    popup = paste("Place Name:", top_20_summary_data$Place_Name, "<br>",
                  "Count:", top_20_summary_data$Count)
  ) 

m

```

Building upon this observation, this paper aims to delve deeper into the themes associated with the India region by employing keyword analysis and collocation analysis methods within the framework of corpus linguistics.

The analysis is conducted in R environment [@R-base], and the main corpus linguistics anlysing methods are applied through functions from [mclm](https://masterclm.github.io/mclm/) [@R-mclm] package. In addition, [tidyverse](https://www.tidyverse.org/) [@R-tidyverse] and [leaflet](https://rstudio.github.io/leaflet/) [@R-leaflet] are used for data manipulation and visualisation.

# Corpus Description

As mentioned earlier, the digitized text of "Natural History" with geographical annotations is readily accessible through the [TOPOSText](https://topostext.org/work/148 "Check Natural History on ToposText") project. In order to facilitate the analysis, I conducted additional scraping of the full text, exporting it as a **reference corpus** in .txt format. Furthermore, I extracted the texts specifically associated with the Indian subcontinent, utilizing the annotated coordinates, creating a **target corpus** of geographically related texts focused on India. The scraping code can be found in the link: .

```{r}
#| label: prepare-corpus
#| warning: false

refcorpus_folder <- here("NH_wholetext")
fnames_wholetext <- get_fnames(refcorpus_folder) %>% 
  keep_re("[.]txt")


tarcorpus_folder <-  here("NH_geotext_india")
fnames_indiatext <- get_fnames(tarcorpus_folder) %>% 
  keep_re("[.]txt")

ref_flist <- freqlist(fnames_wholetext, re_token_splitter = re("\\s+"))
tar_flist <- freqlist(fnames_indiatext, re_token_splitter = re("\\s+"))
```

The **reference corpus** consists of all texts in the encyclopedia, divided by paragraphs, has `r prettyNum(n_tokens(ref_flist))` tokens and `r n_types(ref_flist)` types, with the type-token ratio of `r round(n_types(ref_flist)/n_tokens(ref_flist), 2)`.

And the **target corpus** consists of all text related to Indian subcontinent (with coordinates in range of *8째4'N-37째6'N and 68째7'E to 97째25'E*) , has `r prettyNum(n_tokens(tar_flist))` tokens and `r n_types(tar_flist)` types, with the type-token ratio of `r round(n_types(tar_flist)/n_tokens(tar_flist), 2)`.

The punctuation marks are removed in the tokenization process.

# Keyword Analysis on India-related texts

The frequency list of the **target corpus** (Indian subcontinent related texts) and **reference corpus** (whole text) are generated respectively. And the association scores are calculated and filtered for those returning both PMI and $G^2$ gaining 2 or higher, in order to get the statisticly most significant keyword in India-related texts comparing to the reference corpus.

When calculating the word frequency in the **target corpus**, the word "india" itself is removed from the token in order to get more descriptive words in the corpus, which will be more efficient in implying the possible thematic keyword in the **target corpus**.

```{r}
#| label: keyword
#| warning: false


# build frequency list for target corpus
flist_target <- fnames_indiatext %>%
  freqlist(
    re_token_transf_in = "[[:punct:]]", # Match punctuation marks
    token_transf_out = "", # Replace punctuation marks with an empty string
    re_drop_token = "india"
  )

# build frequency list for reference corpus
flist_ref <- fnames_wholetext %>%
  freqlist(
    re_token_transf_in = "[[:punct:]]", # Match punctuation marks
    token_transf_out = ""
  ) 

# calculate scores
scores_kw <- assoc_scores(flist_target, flist_ref)

top_scores_kw <- scores_kw %>% 
  filter(PMI >= 2 & G_signed >= 2)

```

Tables below shows the top 20 keywords in Indian related texts comparing to other context, respectively sorted by PMI (@tbl-kwtable_PMI) and G_signed (@tbl-kwtable_Gsigned).

::: panel-tabset
## Sorted by PMI

```{r}
#| warning: false
#| echo: false
#| label: tbl-kwtable_PMI
#| tbl-cap-location: top
#| tbl-cap: Top 20 Keywords on Indian Related Text in Natural History (sorted by PMI)

top_scores_kw %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% 
  arrange(desc(PMI)) %>%             
  head(20) %>%                       
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)")) %>% 
  kable_minimal() %>% 
  scroll_box(height = "400px")
```

## Sorted by G_signed

```{r}
#| warning: false
#| echo: false
#| label: tbl-kwtable_Gsigned
#| tbl-cap-location: top
#| tbl-cap: Top 20 Keywords on Indian Related Text in Natural History (sorted by G_Signed)

top_scores_kw %>% # also valid for top_scores_colloc
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% # select 4 columns
  arrange(desc(G_signed)) %>%             # sort by PMI (descending) 
  head(20) %>%                       # select top 30 rows
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)")) %>% 
  kable_minimal() %>% 
  scroll_box(height = "400px")
```
:::

@tbl-kwPMI below shows the explanation of the top 20 keywords in Indian related text.

```{r}
#| warning: false
#| label: tbl-kwPMI

keyword_PMI_tibble <- tibble(
  Word = c("ganges", "beryls", "ichthyophagi", "megasthenes", "obsidian", "bdellium", "agates", "callaina", "condensation", "gerra", "jomanes", "nonius", "prasii", "alia", "carnelian", "cophes", "hypasis", "merchandize", "peppertree", "sacae"),
  Type = c("Proper Noun", "Noun", "Plural Noun", "Proper Noun", "Noun", "Noun", "Noun", "Noun/Proper Noun", "Noun", "Noun/Proper Noun", "Noun/Proper Noun", "Noun/Proper Noun", "Noun/Proper Noun", "Adverb", "Noun", "Noun/Proper Noun", "Noun/Proper Noun", "Noun", "Noun", "Noun/Proper Noun"),
  Exp = c("a major river in India", "a type of gemstone", "a group of people who primarily subsist on fish", "a Greek historian and diplomat", "a type of volcanic glass", "a fragrant resin obtained from certain trees", "a type of semiprecious gemstone", "pale green precious stone (lat)", "the process of vapor turning into a liquid state", "war (lat)", "a Roman nomen gentile, gens or 'family name'", "a Roman nomen gentile, gens or 'family name'", "prase, green coloured gem", "by another / different way / route", "a reddish-brown variety of chalcedony", "a river that rises in the ancient Paropamise range, eventually falling into the Indus river near its confluence with the Cophes river", "a river in north India", "goods or commodities", "a tree that produces peppercorns", "the easternmost nation of Elibe, situated to the south of Ilia and the north of Bern")
) %>% print()

```

# Collocation Analysis on "India" in the whole corpus

```{r}
#| label: collocation
#| warning: false

coocs <- fnames_wholetext %>% 
  surf_cooc("(?xi)  ^ india $", 
            re_token_splitter = r"--[(?xi)    \s+   ]--", # whitespace as token splitter
            re_token_transf_in = "[[:punct:]]", # Match punctuation marks
            token_transf_out = "")

# calculate scores
scores_colloc <- assoc_scores(coocs)

top_scores_colloc <- scores_colloc %>% 
  filter(PMI >= 2 & G_signed >= 2)
```

@tbl-coltable_PMI and @tbl-coltable_Gsigned shows the top 30 collocates to the word "india" in the whole text, respectively sorted by PMI and G_signed.

::: panel-tabset
## Sorted by PMI

```{r}
#| label: tbl-coltable_PMI
#| tbl-cap-location: top
#| tbl-cap: Top 30 collocates to the word "india" in Natural History (sorted by PMI)
#| warning: false
#| echo: false
top_scores_colloc %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% # select 4 columns
  arrange(desc(PMI)) %>%        # sort by G_signed (descending)  
  head(30) %>%                       # select top 30 rows
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)"), escape = FALSE) %>%
  kable_minimal() %>% 
  scroll_box(height = "400px")

```

## Sorted by G_signed

```{r}
#| label: tbl-coltable_Gsigned
#| tbl-cap-location: top
#| tbl-cap: Top 30 collocates to the word "india" in Natural History (sorted by G_signed)
#| warning: false
#| echo: false

top_scores_colloc %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% # select 4 columns
  arrange(desc(G_signed)) %>%        # sort by G_signed (descending)  
  head(30) %>%                       # select top 30 rows
  kbl(col.names = c("Type", "Frequency", "PMI", r"(Signed $G^2$)"), escape = FALSE) %>% 
  kable_minimal() %>% 
  scroll_box(height = "400px") 

```
:::

```{r}
#| label: tbl-coltables1
#| tbl-cap: Top 30 Collocates of word "India" in Natural History
#| tbl-subcap: 
#|  - "Sorted by PMI"
#|  - "Sorted by G_signed"
#| layout-ncol: 2
#| warning: false
#| echo: false
#| output: false



top_scores_colloc %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% # select 4 columns
  arrange(desc(PMI)) %>%        # sort by G_signed (descending)  
  head(30) %>%                       # select top 30 rows
  kbl(col.names = c("Type", "Frequency", "PMI", "(Signed $G^{2}$)")) 

top_scores_colloc %>% 
  as_tibble() %>%
  select(type, a, PMI, G_signed) %>% # select 4 columns
  arrange(desc(G_signed)) %>%        # sort by G_signed (descending)  
  head(30) %>%                       # select top 30 rows
  kbl(col.names = c("Type", "Frequency", "PMI", "(Signed $G^{2}$)")) 


```

# Conclusion

Trade related words (including important transportation milestones, trading goods and the description of the goods (colors, precious, etc.)) are more prone to be occur in the text related to India. It reflects the trading connection of the two empires, and also how the recognition of the other empire for the scholars of that period.
